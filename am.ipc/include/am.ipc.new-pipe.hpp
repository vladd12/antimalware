#ifndef AM_IPC_NEW_PIPE_H
#define AM_IPC_NEW_PIPE_H

#include "am.ipc.base-pipe.hpp"

namespace ipc {
	// Class of Pipe, creating by owner proccess
	class IPC_LIB_API NewPipe: public BasePipe {
	private:
		bool listenFlag;

		// Restriction copying of pipes
		explicit NewPipe(const NewPipe&) { }
		void operator=(const NewPipe&) { }

		// Function for a detached thread listening to connections
		static void WaitConnection(NewPipe*) noexcept;

	public:
		explicit NewPipe(const tchar* const, const uint) throw (...);

		// Pipe is listen requests for read/write
		void ListenCons() noexcept;

		// Pipe stop listening requests for read/write (except the last one)
		void StopListenCons() noexcept;

		// Read message from Pipe by owner
		DWORD GetMsg() throw (...);
	};

	// Fabric for New Pipes
	IPC_LIB_API std::shared_ptr<NewPipe> CreateNewPipe(const tchar* const, const uint);

}

#endif // AM_IPC_NEW_PIPE_H


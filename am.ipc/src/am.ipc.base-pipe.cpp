#include "../include/am.ipc.base-pipe.hpp"

namespace ipc {
	// Constructor
	BasePipe::BasePipe() : _hPipe(INVALID_HANDLE_VALUE), _bufSize(32) { }

	// Destructor
	BasePipe::~BasePipe() throw (...) {
		if (CloseHandle(_hPipe) != TRUE) {
			throw std::runtime_error("Failed closing handle of pipe");
		}
	}

	// Send message to pipe function
	void BasePipe::SendMsg(DWORD msg) throw (...) {
		DWORD cbReplyBytes = sizeof(DWORD), cbWritten;
		BOOL fSuccess = WriteFile(_hPipe, &msg, cbReplyBytes, &cbWritten, NULL);
		if (!fSuccess || cbReplyBytes != cbWritten) {
			throw std::runtime_error("Failed write data to pipe");
		}
	}

}
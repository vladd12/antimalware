#include <cstring>
#include <climits>
#include "InputForm.h"
#include "../MainForm/MainForm.h"

namespace am_ui {
	// Input form constructor
	InputForm::InputForm(MainForm^ mf) {
		InitializeComponent();
		TList = gcnew TaskList(this);
		TList->Add();
		main = mf;
		main->Enabled = false;
	}

	// Input form destructor
	InputForm::~InputForm() {
		if (components) delete components;
		main->Enabled = true;
	}

	// Function for "Ok" button's click event
	void InputForm::btnOk_Click(System::Object^ sender, System::EventArgs^ e) {
		using namespace System::Runtime::InteropServices;
		auto tasks = TList->GetTasks();
		MessageBox::Show(this, tasks, "Test", MessageBoxButtons::OK, MessageBoxIcon::Information);
		auto c_str = static_cast<const char*>(Marshal::StringToHGlobalAnsi(tasks).ToPointer());
		auto str_len = strnlen_s(c_str, INT16_MAX);
		main->SendChoosenTasks(c_str, str_len);
		Marshal::FreeHGlobal(System::IntPtr(reinterpret_cast<long long>(c_str)));
		this->Close();
	}

	// Function for "Cancel" button's click event
	void InputForm::btnCancel_Click(System::Object^ sender, System::EventArgs^ e) {
		this->Close();
	}




}
